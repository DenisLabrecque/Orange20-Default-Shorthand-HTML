const images=document.querySelectorAll("article img"),detailModal=document.querySelector("#detail-modal"),detailBgModal=document.querySelector(".bg");let canShowModal=!0;detailBgModal.addEventListener("transitionend",()=>{if("0"===detailBgModal.style.opacity){const t=document.querySelector("[fullscreen=true]");t.style.zIndex=0,detailBgModal.style.bottom="auto",t.removeAttribute("fullscreen"),canShowModal=!0}});const checkIsImagePortrait=t=>new Promise(e=>{const l=new Image;l.src=t,l.onload=()=>{let t;const o=l.naturalWidth/l.naturalHeight,a=window.innerWidth/window.innerHeight;console.log("pratio",a),t=o<a,e(t)}}),showModal=t=>{const e=t.getAttribute("src"),l=document.querySelector("#detail-modal img");return checkIsImagePortrait(e).then(e=>{const o=t.getAttribute("src");e?(l.style.height="100%",l.style.width="auto"):(l.style.height="auto",l.style.width="100%"),detailModal.style.top=window.scrollY+"px",detailModal.style.height=window.innerHeight+"px",detailModal.style.display="flex",detailBgModal.style.bottom="0",detailBgModal.style.opacity=1,document.querySelector("#detail-modal img").setAttribute("src",o)})},hideModal=()=>{detailBgModal.style.opacity=0,detailModal.style.display="none",canShowModal=!1};let modalDetailPos;const handleBodyScroll=()=>{const{scrollY:t}=window;if(Math.abs(t-modalDetailPos)>50){const t=new Event("click");detailModal.dispatchEvent(t),window.removeEventListener("scroll",handleBodyScroll)}};images.forEach(t=>{fromEvent(t,"click").subscribe(()=>{canShowModal&&(t.setAttribute("fullscreen",!0),console.log("show image"),showModal(t).then(()=>{const e=document.querySelector("#detail-modal img"),l=t.getBoundingClientRect(),o=e.getBoundingClientRect(),{deltaX:a,deltaY:n,deltaWidth:i,deltaHeight:d}=getDelta(l,o);e.animate([{transformOrigin:"top left",transform:`\n          translate(${a}px, ${n}px)\n          scale(${i}, ${d})\n        `},{transformOrigin:"top left",transform:"none"}],{duration:300,easing:"ease-in-out",fill:"both"}).onfinish=()=>{modalDetailPos=window.scrollY,window.addEventListener("scroll",handleBodyScroll)}}))})});const moveElementToFullscreen=t=>{t.style.position="fixed",t.style.left=0,t.style.top=0,t.style.right=0,t.style.bottom=0},moveElementToNormalState=t=>{t.style.position=null,t.style.left=null,t.style.top=null,t.style.right=null,t.style.bottom=null},getDelta=(t,e)=>({deltaX:t.left-e.left,deltaY:t.top-e.top,deltaWidth:t.width/e.width,deltaHeight:t.height/e.height});fromEvent(detailModal,"click").subscribe(()=>{const t=document.querySelector("[fullscreen=true]");if(!t)return;const e=document.querySelector("#detail-modal img");console.log("showImage",t);const l=e.getBoundingClientRect(),o=t.getBoundingClientRect();detailBgModal.style.opacity=0,detailModal.style.display="none",canShowModal=!1;const{deltaX:a,deltaY:n,deltaWidth:i,deltaHeight:d}=getDelta(l,o);t.style.zIndex=100,t.animate([{transformOrigin:"top left",transform:`\n        translate(${a}px, ${n}px)\n        scale(${i}, ${d})\n      `},{transformOrigin:"top left",transform:"none"}],{duration:400,easing:"ease",fill:"both"})});